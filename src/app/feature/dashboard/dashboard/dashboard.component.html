<main class="main">
  <div class="dashboard-container">
    <h1>Population Dashboard</h1>
    
    @if (error()) {
      <div class="error-message">
        <p>Error loading data: {{ error() }}</p>
        <button (click)="populationService.loadAllData()">Retry</button>
      </div>
    }

    @if (isLoading()) {
      <div class="loading">Loading data...</div>
    }

    <div class="map-card">
      @if (allPopulationData().length > 0) {
        <app-maps 
          [allPopulationData]="allPopulationData()">
        </app-maps>
      } @else if (!isLoading()) {
        <div class="loading">No map data available...</div>
      }
    </div>

    <div class="data-card">
      <div class="dropdown-section">
        <app-dropdown
          [options]="dropdownOptions"
          [selectedValue]="selectedDisplayOption()"
          placeholder="Display population by"
          (selectionChange)="onDisplayOptionChange($event)">
        </app-dropdown>

        @if (selectedDisplayOption() === 'country' && countryOptions().length > 0) {
          <app-dropdown
            [options]="countryOptions()"
            [selectedValue]="selectedCountry()"
            placeholder="Select a country"
            (selectionChange)="onCountryChange($event)">
          </app-dropdown>
        }

        @if (selectedDisplayOption() === 'year' && yearOptions().length > 0) {
          <app-dropdown
            [options]="yearOptions()"
            [selectedValue]="selectedYear()"
            placeholder="Select a year"
            (selectionChange)="onYearChange($event)">
          </app-dropdown>
        }
      </div>

      <div class="charts-table-container">
        <div class="chart-section">
          @if (chartData().labels.length > 0) {
            <app-chart
              [chartData]="chartData()"
              [title]="chartTitle()"
              height="500px"
              width="100%">
            </app-chart>
          } @else if (!isLoading()) {
            <div class="loading">No chart data available...</div>
          } @else {
            <div class="loading">Loading chart data...</div>
          }
        </div>

        <div class="table-section">
          @if (tableData().length > 0) {
            <app-table [data]="tableData()" (pageChange)="onTablePageChange($event)"></app-table>
          } @else if (!isLoading()) {
            <div class="loading">No table data available...</div>
          } @else {
            <div class="loading">Loading table data...</div>
          }
        </div>
      </div>
    </div>
  </div>
</main>
